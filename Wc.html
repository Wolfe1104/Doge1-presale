<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Connect Demo</title>
    <style>
        body {
            background-color: #0a0911;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .wallet-button {
            border-radius: 12px;
            height: 44px;
            width: 205px;
            text-align: center;
            border: 2px solid black;
            box-shadow: 3px 4px 0 #000;
            padding: 9px 20px;
            display: flex;
            gap: 10px;
            background-color: white;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .wallet-button:hover {
            filter: brightness(110%);
        }

        .wallet-button p {
            white-space: nowrap;
            color: black;
            margin: 0;
            font-size: 16px;
        }

        .wallet-button.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="wallet-button" id="walletButton" onclick="connectWallet()">
        <p id="buttonText">Connect Wallet</p>
    </div>

    <!-- WalletConnect Dependency -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <!-- Web3.js for blockchain interaction -->
    <script src="https://unpkg.com/web3@1.7.4/dist/web3.min.js"></script>

    <script>
        // Initialize variables
        let provider = null;
        let web3 = null;
        let accounts = null;
        const button = document.getElementById('walletButton');
        const buttonText = document.getElementById('buttonText');

        async function connectWallet() {
            if (button.classList.contains('disabled')) return;

            try {
                // Disable button during connection
                button.classList.add('disabled');
                buttonText.textContent = 'Connecting...';

                // Initialize WalletConnect Provider
                provider = new WalletConnectProvider({
                    rpc: {
                        // Mainnet RPC URL (You can change to other networks)
                        1: "https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
                        // Add more network RPCs if needed
                        4: "https://rinkeby.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161" // Rinkeby testnet
                    },
                    qrcodeModalOptions: {
                        mobileLinks: [
                            "metamask",
                            "trust",
                            "rainbow",
                            "argent"
                        ]
                    }
                });

                // Enable the provider (shows QR code for connection)
                accounts = await provider.enable();

                // Initialize Web3 with WalletConnect provider
                web3 = new Web3(provider);

                // Get connected account
                const account = accounts[0];
                
                // Update button text with shortened address
                const shortAddress = `${account.slice(0, 6)}...${account.slice(-4)}`;
                buttonText.textContent = shortAddress;

                console.log("Connected account:", account);
                console.log("Chain ID:", await web3.eth.getChainId());

                // Add disconnect listener
                provider.on("disconnect", () => {
                    resetButton();
                    console.log("Wallet disconnected");
                });

                // Add chain change listener
                provider.on("chainChanged", (chainId) => {
                    console.log("Chain changed to:", chainId);
                });

                // Add account change listener
                provider.on("accountsChanged", (newAccounts) => {
                    if (newAccounts.length === 0) {
                        resetButton();
                    } else {
                        const newShortAddress = `${newAccounts[0].slice(0, 6)}...${newAccounts[0].slice(-4)}`;
                        buttonText.textContent = newShortAddress;
                    }
                });

            } catch (error) {
                console.error("Failed to connect wallet:", error);
                alert("Failed to connect wallet: " + error.message);
                resetButton();
            }
        }

        function resetButton() {
            button.classList.remove('disabled');
            buttonText.textContent = 'Connect Wallet';
            if (provider) {
                provider.disconnect();
                provider = null;
            }
            accounts = null;
            web3 = null;
        }

        // Add click-outside to disconnect (optional)
        document.addEventListener('click', (event) => {
            if (!button.contains(event.target) && accounts) {
                if (confirm('Disconnect wallet?')) {
                    resetButton();
                }
            }
        });
    </script>
</body>
</html>
